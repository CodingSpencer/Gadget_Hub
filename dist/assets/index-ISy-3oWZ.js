(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();function _(e,o){console.log("[handlePhoneSearch] Called for form:",e,"Index:",o);const n=e.querySelector(".brand-select"),i=e.querySelector(".model-select"),t=e.querySelector(".year-select"),r=e.querySelector(".device-type"),d=e.closest(".device-block");o||(o=d.dataset.formIndex);let u=document.getElementById(`results-${o}`);u||(console.log("[handlePhoneSearch] Creating result container"),u=document.createElement("div"),u.className="form-results",u.id=`results-${o}`,u.style.display="none",d.appendChild(u)),n.innerHTML='<option value="">-- Select a Brand --</option>',i.innerHTML='<option value="">-- Select a Model --</option>',t.innerHTML='<option value="">-- Select Year --</option>';let v=[];fetch("https://devices.capscloud.cloud/phones").then(c=>c.json()).then(c=>{v=c,[...new Set(v.map(l=>l.brand))].sort().forEach(l=>{const a=document.createElement("option");a.value=l,a.textContent=l,n.appendChild(a)})}).catch(c=>console.error(c)),n.onchange=null,i.onchange=null,e.onsubmit=null,n.onchange=()=>{const c=n.value;if(i.innerHTML='<option value="">-- Select a Model --</option>',t.innerHTML='<option value="">-- Select Year --</option>',!c)return;const m=v.filter(l=>l.brand===c).map(l=>l.model);[...new Set(m)].sort().forEach(l=>{const a=document.createElement("option");a.value=l,a.textContent=l,i.appendChild(a)})},i.onchange=()=>{const c=n.value,m=i.value;if(t.innerHTML='<option value="">-- Select Year --</option>',!c||!m)return;[...new Set(v.filter(a=>a.brand===c&&a.model===m).map(a=>a.release_year))].sort().forEach(a=>{const f=document.createElement("option");f.value=a,f.textContent=a,t.appendChild(f)})},e.onsubmit=c=>{c.preventDefault();const m=n.value,l=i.value,a=t.value;if(!m||!l||!a){alert("Please select brand, model, and year.");return}if(r.value!=="smartphone"){alert("Only smartphones are supported.");return}const f=v.filter(s=>s.brand===m&&s.model===l&&String(s.release_year)===a);f.length===0?u.innerHTML=`<p>No matching device found for "${m} ${l} (${a})".</p>`:u.innerHTML=`
        <h2>Device Found</h2>
        ${f.map(s=>`
          <ul class="result">
            <li><strong>Brand:</strong> ${s.brand}</li>
            <li><strong>Model:</strong> ${s.model}</li>
            <li><strong>Release Year:</strong> ${s.release_year}</li>
            <li><strong>OS:</strong> ${s.os}</li>
            <li><strong>RAM:</strong> ${s.ram_gb} GB</li>
            <li><strong>Storage:</strong> ${s.storage_gb} GB</li>
            <li><strong>Battery:</strong> ${s.battery_mAh} mAh</li>
            <li><strong>Camera:</strong> ${s.camera_mp} MP</li>
            <li><strong>RFID:</strong> ${s.rfid?"Yes":"No"}</li>
            <li><strong>Unlock Methods:</strong> ${s.unlock_methods.join(", ")}</li>
          </ul>
        `).join("")}
        <button class="search-again-btn">Search Again</button>
      `,u.style.display="block";const g=u.querySelector(".search-again-btn");g&&(g.onclick=()=>{e.reset(),n.innerHTML='<option value="">-- Select a Brand --</option>',i.innerHTML='<option value="">-- Select a Model --</option>',t.innerHTML='<option value="">-- Select Year --</option>',[...new Set(v.map(y=>y.brand))].sort().forEach(y=>{const h=document.createElement("option");h.value=y,h.textContent=y,n.appendChild(h)}),u.style.display="none",u.innerHTML="",e.style.display="block"})}}let T=0;function M(e){T++;const o=e.querySelector(".device-type"),n=e.querySelector(".brand-select"),i=e.querySelector(".model-select"),t=e.querySelector(".year-select"),r=e.closest(".device-block");if(r){r.dataset.formIndex=T;const u=r.querySelector(".form-results");u&&(u.id=`results-${T}`)}const d=()=>{const u=o.value;n.innerHTML='<option value="">-- Select a Brand --</option>',i.innerHTML='<option value="">-- Select a Model --</option>',t.innerHTML='<option value="">-- Select Year --</option>',u==="smartphone"&&_(e,T)};o.addEventListener("change",d),d()}const E=6,B=2;function L(){const e=document.getElementById("deviceInfo"),o=e.querySelectorAll(".device-block"),n=document.getElementById("addDeviceButton"),i=o.length;o.forEach(t=>t.style.gridColumn=""),i===1?(e.style.gridTemplateColumns="1fr",o[0].style.gridColumn="1 / -1",n.style.display="block"):i===2?(e.style.gridTemplateColumns="repeat(2, 1fr)",o.forEach(t=>t.style.gridColumn="span 1"),n.style.display="block"):i===3?(e.style.gridTemplateColumns="repeat(3, 1fr)",o.forEach(t=>t.style.gridColumn="span 1"),n.style.display="block"):i===4?(e.style.gridTemplateColumns="repeat(2, 1fr)",o.forEach(t=>t.style.gridColumn="span 1"),n.style.display="block"):i===5?(e.style.gridTemplateColumns="repeat(3, 1fr)",o.forEach(t=>t.style.gridColumn="span 1"),n.style.display="block"):i>=6&&(e.style.gridTemplateColumns="repeat(3, 1fr)",o.forEach(t=>t.style.gridColumn="span 1"),n.style.display="none"),n.style.display!=="none"&&(n.style.gridColumn="1 / -1")}function q(){return[...document.querySelectorAll(".deviceInfoForm")].filter(e=>{const o=e.closest(".device-block").querySelector(".form-results"),n=!o||o.style.display==="none",i=!e.querySelector(".brand-select").value,t=!e.querySelector(".model-select").value,r=!e.querySelector(".year-select").value;return n&&(i||t||r)}).length}function A(){return document.querySelectorAll(".deviceInfoForm").length}function k(){const e=document.createElement("div");e.classList.add("device-block");const o=document.createElement("form");o.classList.add("deviceInfoForm"),o.innerHTML=`
    <h2>Device Information</h2>
    <label for="deviceType">Device Type</label>
    <select class="device-type" name="deviceType">
      <option value="smartphone">Smartphone</option>
      <option value="tablet">Tablet</option>
      <option value="laptop">Laptop</option>
      <option value="desktop">Desktop</option>
      <option value="wearable">Wearable</option>
    </select>

    <label for="brand">Brand:</label>
    <select class="brand-select" name="brand" required>
      <option value="">-- Select a Brand --</option>
    </select>

    <label for="model">Model:</label>
    <select class="model-select" name="model" required>
      <option value="">-- Select a Model --</option>
    </select>

    <label for="year">Year:</label>
    <select class="year-select" name="year" required>
      <option value="">-- Select Year --</option>
    </select>

    <button type="submit">Search</button>
    <button type="button" class="removeFormButton">Remove</button>
  `;const n=document.createElement("div");return n.classList.add("form-results"),n.style.display="none",o.querySelector(".removeFormButton").addEventListener("click",()=>{e.remove(),L()}),e.appendChild(o),e.appendChild(n),e}function $(){const e=()=>{const o=document.getElementById("addDeviceButton"),n=document.getElementById("deviceInfo");!o||!n||([...n.querySelectorAll(".deviceInfoForm")].forEach(i=>{M(i)}),o.addEventListener("click",()=>{const i=A(),t=q();if(i>=E){alert(`You can only add up to ${E} devices.`);return}if(t>=B){alert("Please fill out or remove existing empty forms before adding a new one.");return}const r=k();n.insertBefore(r,o);const d=r.querySelector("form.deviceInfoForm");M(d),L()}),L())};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}function H(e){const o=e.querySelector(".device-type"),n=e.querySelector(".trait-select"),i=e.querySelector(".recommend-btn"),r=e.closest("#recommend-section").querySelector(".recommendations");if(!r){console.error("Result container not found. Check .recommendations element in HTML.");return}const d=document.createElement("button");d.textContent="Reset",d.className="reset-btn",d.style.display="none",d.type="button",r.appendChild(d),r.style.display="none";let u=[];fetch("https://devices.capscloud.cloud/phones").then(c=>c.json()).then(c=>{u=c,console.log("Loaded device data:",u),v(o.value)}).catch(c=>{console.error("Failed to fetch device data:",c)});function v(c){if(console.log("Populating traits for device type:",c),n.innerHTML='<option value="">Overall</option>',!c)return;const m=["release_year","screen_size_in","battery_mAh","ram_gb","storage_gb","camera_mp","rfid","os","original_price_usd","unlock_methods"],l={release_year:"Release Year",screen_size_in:"Screen Size (in)",battery_mAh:"Battery (mAh)",ram_gb:"RAM (GB)",storage_gb:"Storage (GB)",camera_mp:"Camera (MP)",rfid:"RFID",os:"Operating System",original_price_usd:"Original Price (USD)",unlock_methods:"Unlock Methods"},a=new Set;u.forEach(g=>{(g.deviceType||"smartphone").toLowerCase()===c.toLowerCase()&&m.forEach(y=>{g[y]!==void 0&&g[y]!==null&&a.add(y)})});const f=[...a].sort();console.log("Available traits:",f),f.forEach(g=>{const s=document.createElement("option");s.value=g,s.textContent=l[g]||g,n.appendChild(s)})}o.addEventListener("change",()=>{console.log("Device type changed:",o.value),v(o.value)}),i.addEventListener("click",c=>{c.preventDefault();const m=o.value,l=n.value;if(console.log("Recommend clicked. Device Type:",m,"Trait:",l),!m||!l){alert("Please select both device type and trait.");return}let a=u.filter(s=>(s.deviceType||"smartphone").toLowerCase()===m.toLowerCase());a=a.filter(s=>{if(!(l in s))return Array.isArray(s.unlock_methods)&&s.unlock_methods.includes(l);const y=s[l];return Array.isArray(y)?y.length>0:y!=null}),console.log("Filtered results:",a.length);const f=r.querySelector("h3");f&&f.remove();const g=r.querySelector(".recommend-grid");if(g&&g.remove(),a.length===0){const s=document.createElement("p");s.innerHTML=`No devices found for <strong>${m}</strong> with trait <strong>${l}</strong>.`,r.insertBefore(s,d)}else{a.sort((p,b)=>{const S=Array.isArray(p[l])?p[l][0]:p[l],C=Array.isArray(b[l])?b[l][0]:b[l];return typeof S=="number"&&typeof C=="number"?C-S:typeof S=="string"&&typeof C=="string"?S.localeCompare(C):0});const s=a.slice(0,10),y=document.createElement("h3");y.innerHTML=`Top 10 Devices for Trait: <em>${l.replace(/_/g," ")}</em>`,r.insertBefore(y,d);const h=document.createElement("div");h.className="recommend-grid",s.forEach(p=>{const b=document.createElement("div");b.className="recommend-card",b.innerHTML=`
          <ul class="result">
            <li><strong>Brand:</strong> ${p.brand}</li>
            <li><strong>Model:</strong> ${p.model}</li>
            <li><strong>Device Type:</strong> ${p.deviceType}</li>
            <li><strong>Release Year:</strong> ${p.release_year||"N/A"}</li>
            <li><strong>Battery:</strong> ${p.battery_mAh?p.battery_mAh+" mAh":"N/A"}</li>
            <li><strong>RAM:</strong> ${p.ram_gb?p.ram_gb.join(", ")+" GB":"N/A"}</li>
            <li><strong>Storage:</strong> ${p.storage_gb?p.storage_gb.join(", ")+" GB":"N/A"}</li>
            <li><strong>Camera:</strong> ${p.camera_mp?p.camera_mp.join(", ")+" MP":"N/A"}</li>
            <li><strong>RFID:</strong> ${p.rfid?"Yes":"No"}</li>
            <li><strong>Unlock Methods:</strong> ${p.unlock_methods?p.unlock_methods.join(", "):"N/A"}</li>
          </ul>
        `,h.appendChild(b)}),r.appendChild(h),r.appendChild(d)}r.style.display="block",d.style.display="inline-block",e.style.display="none"}),d.addEventListener("click",()=>{console.log("Reset button clicked"),e.reset(),n.innerHTML='<option value="">Overall</option>';const c=r.querySelector("h3");c&&c.remove();const m=r.querySelector(".recommend-grid");m&&m.remove();const l=r.querySelector("p");l&&l.remove(),r.style.display="none",e.style.display="block",d.style.display="none"})}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".recommendForm");e?H(e):console.warn("Recommend form not found!"),$()});
